C51 COMPILER V9.54   MARTRIXKEY                                                            10/31/2025 09:42:30 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MARTRIXKEY
OBJECT MODULE PLACED IN .\Objects\MartrixKey.obj
COMPILER INVOKED BY: E:\keil5\C51\BIN\C51.EXE MartrixKey.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\
                    -MartrixKey.lst) TABS(2) OBJECT(.\Objects\MartrixKey.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "delay.h"
   3          #include "LCD1602.h"
   4          
   5          unsigned char MartrixKey()
   6          {
   7   1          unsigned char KeyNum = 0;
   8   1          unsigned char i, j, q;
   9   1      
  10   1          // 扫描4列
  11   1          for (j = 0; j < 4; j++)
  12   1          {
  13   2              // 设置所有列为高电平
  14   2              P1 = 0xFF;
  15   2      
  16   2              // 将当前列设置为低电平
  17   2              switch (j)
  18   2              {
  19   3              case 0: P1_3 = 0; break;  // 第1列
  20   3              case 1: P1_2 = 0; break;  // 第2列
  21   3              case 2: P1_1 = 0; break;  // 第3列
  22   3              case 3: P1_0 = 0; break;  // 第4列
  23   3              }
  24   2      
  25   2              // 检测行状态
  26   2              switch (j)
  27   2              {
  28   3              case 0:  // 第1列
  29   3                  for (i = 7, q = 1; i >= 5; i--, q++)
  30   3                  {
  31   4                      if (i == 7 && P1_7 == 0) KeyNum = q;
  32   4                      else if (i == 6 && P1_6 == 0) KeyNum = q;
  33   4                      else if (i == 5 && P1_5 == 0) KeyNum = q;
  34   4      
  35   4                      if (KeyNum != 0)
  36   4                      {
  37   5                          Delay(10);  // 消抖
  38   5                          // 等待按键释放
  39   5                          if (i == 7) while (P1_7 == 0);
  40   5                          else if (i == 6) while (P1_6 == 0);
  41   5                          else if (i == 5) while (P1_5 == 0);
  42   5                          Delay(10);  // 消抖
  43   5                          return KeyNum;
  44   5                      }
  45   4                  }
  46   3                  break;
  47   3      
  48   3              case 1:  // 第2列
  49   3                  for (i = 7, q = 4; i >= 5; i--, q++)
  50   3                  {
  51   4                      if (i == 7 && P1_7 == 0) KeyNum = q;
  52   4                      else if (i == 6 && P1_6 == 0) KeyNum = q;
  53   4                      else if (i == 5 && P1_5 == 0) KeyNum = q;
  54   4      
C51 COMPILER V9.54   MARTRIXKEY                                                            10/31/2025 09:42:30 PAGE 2   

  55   4                      if (KeyNum != 0)
  56   4                      {
  57   5                          Delay(10);
  58   5                          if (i == 7) while (P1_7 == 0);
  59   5                          else if (i == 6) while (P1_6 == 0);
  60   5                          else if (i == 5) while (P1_5 == 0);
  61   5                          Delay(10);
  62   5                          return KeyNum;
  63   5                      }
  64   4                  }
  65   3      
  66   3                  // 检查特殊按键
  67   3                  if (P1_4 == 0)
  68   3                  {
  69   4                      Delay(10);
  70   4                      while (P1_4 == 0);
  71   4                      Delay(10);
  72   4                      return 0;  // 返回0
  73   4                  }
  74   3                  break;
  75   3      
  76   3              case 2:  // 第3列
  77   3                  for (i = 7, q = 7; i >= 5; i--, q++)
  78   3                  {
  79   4                      if (i == 7 && P1_7 == 0) KeyNum = q;
  80   4                      else if (i == 6 && P1_6 == 0) KeyNum = q;
  81   4                      else if (i == 5 && P1_5 == 0) KeyNum = q;
  82   4      
  83   4                      if (KeyNum != 0)
  84   4                      {
  85   5                          Delay(10);
  86   5                          if (i == 7) while (P1_7 == 0);
  87   5                          else if (i == 6) while (P1_6 == 0);
  88   5                          else if (i == 5) while (P1_5 == 0);
  89   5                          Delay(10);
  90   5                          return KeyNum;
  91   5                      }
  92   4                  }
  93   3                  break;
  94   3      
  95   3              case 3:  // 第4列
  96   3                  // 检查特殊按键
  97   3                  if (P1_7 == 0)
  98   3                  {
  99   4                      Delay(10);
 100   4                      while (P1_7 == 0);
 101   4                      Delay(10);
 102   4                      KeyNum = 0;
 103   4                      return KeyNum;              // 返回0
 104   4                  }
 105   3      
 106   3                  // 检查其他按键
 107   3                  for (i = 6, q = 10; i >= 5; i--, q++)
 108   3                  {
 109   4                      if (i == 6 && P1_6 == 0) KeyNum = q;
 110   4                      else if (i == 5 && P1_5 == 0) KeyNum = q;
 111   4      
 112   4                      if (KeyNum != 0)
 113   4                      {
 114   5                          Delay(10);
 115   5                          if (i == 6) while (P1_6 == 0);
 116   5                          else if (i == 5) while (P1_5 == 0);
C51 COMPILER V9.54   MARTRIXKEY                                                            10/31/2025 09:42:30 PAGE 3   

 117   5                          Delay(10);
 118   5                          return KeyNum;
 119   5                      }
 120   4                  }
 121   3                  break;
 122   3              }
 123   2          }
 124   1      
 125   1          return KeyNum;  // 没有按键按下返回0
 126   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    488    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
